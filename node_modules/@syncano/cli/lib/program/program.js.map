{"version":3,"sources":["../../src/program/program.js"],"names":["program","Command","prototype","missingArgument","name","format","cyan","red","outputHelp","process","exit","optionMissingArgument","option","flag","flags","group","_group","commandHelp","commands","length","plugins","Object","keys","session","getPluginsInstance","forEach","cmd","indexOf","_name","_plugin","humanReadableArgName","arg","nameOutput","variadic","required","white","grey","pad","str","width","len","Math","max","Array","join","printCmd","args","_args","map","_alias","options","_description","commandGroups","filter","_noHelp","push","pluginsCommands","printList","title","reduce","command","comnds","desc","replace","allCommands","groupName","concat","pluginsCommandsList","helpInformation","currentInstance","project","instance","instanceName","yellow","cmdName","usage","cmds","optionHelp"],"mappings":"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","file":"program.js","sourcesContent":["/* eslint no-underscore-dangle: \"warn\" */\n/* eslint no-param-reassign: \"warn\" */\n/* eslint no-underscore-dangle: 0 */\nimport program from 'commander'\nimport format from 'chalk'\nimport stripAnsi from 'strip-ansi'\nimport { echo } from '../utils/print-tools'\nimport session from '../utils/session'\n\nprogram.Command.prototype.missingArgument = (name) => {\n  echo(`\\nerror: ${format.cyan(`<${name}>`)} argument is ${format.red('required!')}`)\n  program.outputHelp()\n  process.exit(1)\n}\n\nprogram.Command.prototype.optionMissingArgument = (option, flag) => {\n  if (flag) {\n    echo(`\\nerror: missing ${format.cyan(`<${option.flags}>`)} argument, got ${format.red(flag)}`)\n  }\n\n  if (!flag) {\n    echo(`\\nerror: ${format.cyan(`${option.flags}`)} argument is ${format.red('required!')}`)\n  }\n\n  program.outputHelp()\n  process.exit(1)\n}\n\nprogram.Command.prototype.group = function (group) {\n  this._group = group // eslint-disable-line\n  return this\n}\n\n// We are overriding this mainly to show separetly normal command and plugins\nprogram.Command.prototype.commandHelp = () => {\n  if (!program.commands.length) return ''\n\n  // Search for plugins commands\n  const plugins = Object.keys(session.getPluginsInstance().plugins)\n  program.commands.forEach((cmd) => {\n    if (!plugins.indexOf(cmd._name)) { // eslint-disable-line\n      cmd._plugin = true // eslint-disable-line\n    }\n  })\n\n  function humanReadableArgName (arg) {\n    const nameOutput = arg.name + (arg.variadic === true ? '...' : '')\n    return arg.required ? `${format.white(`<${(nameOutput)}>`)}` : `${format.grey(`[${(nameOutput)}]`)}`\n  }\n\n  function pad (str, width) {\n    const len = Math.max(0, width - stripAnsi(str).length)\n    return str + Array(len + 1).join(' ')\n  }\n\n  function printCmd (cmd) {\n    const args = cmd._args.map((arg) => humanReadableArgName(arg)).join(' ') // eslint-disable-line\n\n    return [\n      [\n        format.cyan(cmd._name), // eslint-disable-line\n        (cmd._alias ? `|${cmd._alias}` : ''), // eslint-disable-line\n        format.grey((cmd.options.length ? ' [options]' : '')),\n        ' ',\n        args\n      ].join(''),\n      cmd._description\n    ]\n  }\n\n  const commandGroups = {}\n  // Grouping commands\n  program\n    .commands\n    .filter((cmd) => !cmd._noHelp && !cmd._plugin && cmd._name !== 'help')\n    .map((cmd) => {\n      let group = ''\n      if (cmd._group) {\n        group = cmd._group\n      } else {\n        group = 'Other'\n      }\n      if (!commandGroups[group]) { commandGroups[group] = [] }\n      commandGroups[group].push(printCmd(cmd))\n      return printCmd(cmd)\n    })\n\n  // Plugins commands\n  const pluginsCommands = program\n    .commands\n    .filter((cmd) => !cmd._noHelp && cmd._plugin)\n    .map((cmd) => printCmd(cmd))\n\n  function printList (commands, title) {\n    const width = commands.reduce((max, command) => Math.max(max, stripAnsi(command[0]).length), 0)\n    const comnds = commands.map((cmd) => {\n      const desc = cmd[1] ? `    ${cmd[1]}` : ''\n      return pad(cmd[0], width) + desc\n    }).join('\\n').replace(/^/gm, '    ')\n\n    return [\n      '',\n      `  ${format.grey(title)}:`,\n      '',\n      comnds,\n      ''\n    ].join('\\n')\n  }\n\n  let allCommands = []\n\n  Object.keys(commandGroups).forEach((groupName) => {\n    allCommands = allCommands.concat(printList(commandGroups[groupName], groupName))\n  })\n\n  const pluginsCommandsList = pluginsCommands.length ? printList(pluginsCommands, 'Plugins') : []\n\n  return allCommands.join('').concat(pluginsCommandsList)\n}\n\nprogram.Command.prototype.helpInformation = function () {\n  let currentInstance = ''\n  if (session.project && session.project.instance) {\n    const instanceName = session.project.instance\n    currentInstance = instanceName ? `\\n\\n  Current Instance: ${format.yellow((instanceName))}` : ''\n  }\n\n  const desc = this._description ? [`  ${this._description}`, ''] : []\n  const cmdName = this._alias ? `${this._name}|${this._alias}` : this._name\n  const usage = [`\\n  Usage: ${cmdName} ${this.usage()} ${currentInstance}`]\n\n  const commandHelp = this.commandHelp()\n\n  const cmds = commandHelp ? [commandHelp] : []\n  const options = [\n    '  Options:\\n',\n    `${this.optionHelp().replace(/^/gm, '    ')}\\n\\n`\n  ]\n\n  return usage\n    .concat(cmds)\n    .concat(desc)\n    .concat(options)\n    .join('\\n')\n}\n\nexport default program\n"]}