{"version":3,"sources":["../../src/commands/init.js"],"names":["debug","InitCmd","constructor","context","session","Init","run","cmd","project","settings","instance","process","env","INIT_CWD","account","authenticated","format","red","Login","init","questions","name","type","message","choices","getTemplatesChoices","map","choice","default","cyan","promptResponses","inquirer","prompt","templateName","Template","match","checkConnection","addConfigFiles","green","createFilesAndFolders","newInstance","load","checkConfigFiles","noConfigFiles"],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA;;;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAEA,MAAM,EAAEA,KAAF,KAAY,qBAAO,UAAP,CAAlB;;AAEA,MAAMC,OAAN,CAAc;AACZC,cAAaC,OAAb,EAAsB;AACpBH,UAAM,qBAAN;AACA,SAAKG,OAAL,GAAeA,OAAf;AACA,SAAKC,OAAL,GAAeD,QAAQC,OAAvB;AACA,SAAKC,IAAL,GAAYF,QAAQE,IAApB;AACD;;AAEKC,KAAN,CAAW,CAACC,GAAD,CAAX,EAAkB;AAAA;;AAAA;AAChB,YAAM,EAAEC,OAAF,EAAWC,QAAX,KAAwB,MAAKL,OAAnC;AACA,YAAM,EAAEM,QAAF,KAAeH,GAArB;;AAEA,UAAII,QAAQC,GAAR,CAAYC,QAAhB,EAA0B;AACxB,8BAAM,cAAN;AACD;;AAED,UAAI,CAACJ,SAASK,OAAT,CAAiBC,aAAjB,EAAL,EAAuC;AACrC;AACA,8BAAK,CAAL,EAAQC,gBAAOC,GAAP,CAAW,uDAAX,CAAR;AACA,cAAM,IAAIC,eAAJ,CAAU,MAAKf,OAAf,EAAwBG,GAAxB,CAA4B,EAA5B,CAAN;AACD;;AAED,YAAKa,IAAL,GAAY,IAAI,MAAKd,IAAT,EAAZ;;AAEA,YAAMe,YAAY,CAChB;AACEC,cAAM,UADR;AAEEC,cAAM,MAFR;AAGEC,iBAAS,mBAAE,CAAF,EAAK,kCAAL,CAHX;AAIEC,iBAAS,MAAKnB,IAAL,CAAUoB,mBAAV,GAAgCC,GAAhC,CAAoC;AAAA,iBAAU,mBAAE,CAAF,EAAKC,MAAL,CAAV;AAAA,SAApC,CAJX;AAKEC,iBAAS;AALX,OADgB,CAAlB;;AAUA,UAAI,CAACpB,OAAL,EAAc;AACZ;AACA,8BAAK,CAAL,EAAQQ,gBAAOa,IAAP,CAAY,2BAAZ,CAAR;AACA;AACD,OAJD,MAIO;AACL;AACA,8BAAK,CAAL,EAAQ,8DAAR;AACA,8BAAK,CAAL,EAAQ,iEAAR;AACA;AACD;;AAED,YAAMC,kBAAkB,MAAMC,mBAASC,MAAT,CAAgBZ,SAAhB,CAA9B;AACA,YAAKD,IAAL,CAAUc,YAAV,GAAyBH,gBAAgBI,QAAhB,CAAyBC,KAAzB,CAA+B,UAA/B,EAA2C,CAA3C,CAAzB;;AAEA,UAAI,CAAC3B,OAAD,IAAYE,QAAhB,EAA0B;AACxB,cAAM,MAAKN,OAAL,CAAagC,eAAb,CAA6B1B,QAA7B,CAAN;AACA,cAAM,MAAKS,IAAL,CAAUkB,cAAV,CAAyB,EAAE3B,QAAF,EAAzB,CAAN;AACA,8BAAK,CAAL,EAAS,+BAA8BM,gBAAOsB,KAAP,CAAa5B,SAASW,IAAtB,CAA4B,gBAAnE;;AAEA,eAAO,MAAKF,IAAL,CAAUoB,qBAAV,EAAP;AACD;;AAED,UAAI,CAAC/B,OAAD,IAAY,CAACE,QAAjB,EAA2B;AACzBV,cAAM,yBAAN;AACA,cAAMwC,cAAc,MAAM,qCAA1B;;AAEA,cAAM,MAAKrB,IAAL,CAAUkB,cAAV,CAAyB,EAAE3B,UAAU8B,YAAYnB,IAAxB,EAAzB,CAAN;AACA,8BAAK,CAAL,EAAS,+BAA8BL,gBAAOsB,KAAP,CAAaE,YAAYnB,IAAzB,CAA+B,gBAAtE;;AAEA,cAAKF,IAAL,CAAUoB,qBAAV;AACA,eAAO,MAAKnC,OAAL,CAAaqC,IAAb,EAAP;AACD;;AAED,UAAI,MAAKtB,IAAL,CAAUuB,gBAAV,EAAJ,EAAkC;AAChC,eAAO,MAAKvB,IAAL,CAAUwB,aAAV,EAAP;AACD;AA7De;AA8DjB;AAtEW;;kBAyEC1C,O","file":"init.js","sourcesContent":["import format from 'chalk'\nimport inquirer from 'inquirer'\n\nimport logger from '../utils/debug'\nimport { createInstance } from './helpers/create-instance'\nimport { p, echo } from '../utils/print-tools'\nimport { track } from '../utils/analytics'\nimport Login from './login'\n\nconst { debug } = logger('cmd-init')\n\nclass InitCmd {\n  constructor (context) {\n    debug('InitCmd.constructor')\n    this.context = context\n    this.session = context.session\n    this.Init = context.Init\n  }\n\n  async run ([cmd]) {\n    const { project, settings } = this.session\n    const { instance } = cmd\n\n    if (process.env.INIT_CWD) {\n      track('CLI: install')\n    }\n\n    if (!settings.account.authenticated()) {\n      echo()\n      echo(4)(format.red('You have to be logged in to initialize a new project!'))\n      await new Login(this.context).run([])\n    }\n\n    this.init = new this.Init()\n\n    const questions = [\n      {\n        name: 'Template',\n        type: 'list',\n        message: p(2)('Choose template for your project'),\n        choices: this.Init.getTemplatesChoices().map(choice => p(4)(choice)),\n        default: 1\n      }\n    ]\n\n    if (!project) {\n      echo()\n      echo(4)(format.cyan('New project? Exciting! ðŸŽ‰'))\n      echo()\n    } else {\n      echo()\n      echo(4)('I found the Syncano instance for the project in this folder,')\n      echo(4)(\"but you don't have any config files - I'll create them for you!\")\n      echo()\n    }\n\n    const promptResponses = await inquirer.prompt(questions)\n    this.init.templateName = promptResponses.Template.match(/\\((.*)\\)/)[1]\n\n    if (!project && instance) {\n      await this.session.checkConnection(instance)\n      await this.init.addConfigFiles({ instance })\n      echo(4)(`Your project is attached to ${format.green(instance.name)} instance now!`)\n\n      return this.init.createFilesAndFolders()\n    }\n\n    if (!project && !instance) {\n      debug('no project, no instance')\n      const newInstance = await createInstance()\n\n      await this.init.addConfigFiles({ instance: newInstance.name })\n      echo(4)(`Your project is attached to ${format.green(newInstance.name)} instance now!`)\n\n      this.init.createFilesAndFolders()\n      return this.session.load()\n    }\n\n    if (this.init.checkConfigFiles()) {\n      return this.init.noConfigFiles()\n    }\n  }\n}\n\nexport default InitCmd\n"]}