{"version":3,"sources":["../../src/commands/socket-submit.js"],"names":["debug","SocketSubmitCmd","constructor","context","session","Socket","run","socketName","cmd","availabeVerionTypes","bump","indexOf","format","cyan","join","process","exit","socket","getLocal","existLocally","bumpVersion","name","dim","spec","version","submit","publishCommand","green","err","CompatibilityError","message","response","data"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,MAAM,EAAEA,KAAF,KAAY,qBAAO,YAAP,CAAlB;;AAEe,MAAMC,eAAN,CAAsB;AACnCC,cAAaC,OAAb,EAAsB;AACpB,SAAKC,OAAL,GAAeD,QAAQC,OAAvB;AACA,SAAKC,MAAL,GAAcF,QAAQE,MAAtB;AACD;;AAEKC,KAAN,CAAW,CAACC,UAAD,EAAaC,GAAb,CAAX,EAA8B;AAAA;;AAAA;AAC5B,YAAMC,sBAAsB,CAC1B,OAD0B,EACjB,UADiB,EACL,OADK,EACI,UADJ,EACgB,OADhB,EACyB,UADzB,EACqC,YADrC,CAA5B;AAGA,UAAID,IAAIE,IAAJ,IAAYD,oBAAoBE,OAApB,CAA4BH,IAAIE,IAAhC,MAA0C,CAAC,CAA3D,EAA8D;AAC5D;AACA,8BAAK,CAAL,EAAS,uBAAsBE,gBAAOC,IAAP,CAAYL,IAAIE,IAAhB,CAAsB,EAArD;AACA,8BAAK,CAAL,EAAS,gBAAeD,oBAAoBK,IAApB,CAAyB,IAAzB,CAA+B,EAAvD;AACA;AACAC,gBAAQC,IAAR;AACD;;AAED,YAAKC,MAAL,GAAc,MAAM,MAAKZ,MAAL,CAAYa,QAAZ,CAAqBX,UAArB,CAApB;;AAEA,UAAI,CAAC,MAAKU,MAAL,CAAYE,YAAjB,EAA+B;AAC7B;AACA,+BAAM,CAAN,EAAU,UAASP,gBAAOC,IAAP,CAAYN,UAAZ,CAAwB,mBAA3C;AACA;AACAQ,gBAAQC,IAAR,CAAa,CAAb;AACD;;AAED,UAAIR,IAAIE,IAAR,EAAc;AACZ,cAAKO,MAAL,CAAYG,WAAZ,CAAwBZ,IAAIE,IAA5B;AACD;;AAED;AACA,6BAAM,CAAN,EAAU,qBAAoBE,gBAAOC,IAAP,CAAY,MAAKI,MAAL,CAAYI,IAAxB,CAA8B,GAA5D;AACA,6BAAMT,gBAAOU,GAAP,CAAY,IAAG,MAAKL,MAAL,CAAYM,IAAZ,CAAiBC,OAAQ,OAAxC,CAAN;;AAEA,UAAI;AACF,cAAM,MAAKP,MAAL,CAAYQ,MAAZ,EAAN;AACA,cAAMC,iBAAiBd,gBAAOC,IAAP,CAAY,qBAAZ,EAAmC,MAAKI,MAAL,CAAYI,IAA/C,CAAvB;AACA,8BAAKT,gBAAOe,KAAP,CAAa,OAAb,CAAL;AACA,+BAAM,CAAN,EAAS,wCAAT;AACA,8BAAM,QAAOD,cAAe,qCAA5B;AACA;AACD,OAPD,CAOE,OAAOE,GAAP,EAAY;AACZ5B,cAAM4B,GAAN;AACA,YAAIA,eAAeC,0BAAnB,EAAuC;AACrC,iCAAM,CAAN,EAASD,IAAIE,OAAb;AACA;AACD,SAHD,MAGO,IAAIF,IAAIG,QAAJ,IAAgBH,IAAIG,QAAJ,CAAaC,IAAjC,EAAuC;AAC5C,iCAAM,CAAN,EAASJ,IAAIG,QAAJ,CAAaC,IAAb,CAAkBF,OAA3B;AACA;AACD,SAHM,MAGA;AACL,iCAAM,CAAN,EAASF,IAAIE,OAAb;AACD;AACDf,gBAAQC,IAAR,CAAa,CAAb;AACD;AAhD2B;AAiD7B;AAvDkC;kBAAhBf,e","file":"socket-submit.js","sourcesContent":["import format from 'chalk'\nimport logger from '../utils/debug'\nimport { CompatibilityError } from '../utils/errors'\nimport { error, echo, echon } from '../utils/print-tools'\n\nconst { debug } = logger('cmd-submit')\n\nexport default class SocketSubmitCmd {\n  constructor (context) {\n    this.session = context.session\n    this.Socket = context.Socket\n  }\n\n  async run ([socketName, cmd]) {\n    const availabeVerionTypes = [\n      'major', 'premajor', 'minor', 'preminor', 'patch', 'prepatch', 'prerelease'\n    ]\n    if (cmd.bump && availabeVerionTypes.indexOf(cmd.bump) === -1) {\n      echo()\n      echo(4)(`Wrong version type: ${format.cyan(cmd.bump)}`)\n      echo(4)(`Choose from: ${availabeVerionTypes.join(', ')}`)\n      echo()\n      process.exit()\n    }\n\n    this.socket = await this.Socket.getLocal(socketName)\n\n    if (!this.socket.existLocally) {\n      echo()\n      error(4)(`Socket ${format.cyan(socketName)} cannot be found!`)\n      echo()\n      process.exit(1)\n    }\n\n    if (cmd.bump) {\n      this.socket.bumpVersion(cmd.bump)\n    }\n\n    echo()\n    echon(4)(`Submitting Socket ${format.cyan(this.socket.name)} `)\n    echon(format.dim(`(${this.socket.spec.version})... `))\n\n    try {\n      await this.socket.submit()\n      const publishCommand = format.cyan('syncano-cli publish', this.socket.name)\n      echo(format.green('Done!'))\n      echon(4)('By default your socket is private ðŸ”’. ')\n      echo(`Type ${publishCommand} to make it available for everyone!`)\n      echo()\n    } catch (err) {\n      debug(err)\n      if (err instanceof CompatibilityError) {\n        error(4)(err.message)\n        echo()\n      } else if (err.response && err.response.data) {\n        error(4)(err.response.data.message)\n        echo()\n      } else {\n        error(4)(err.message)\n      }\n      process.exit(1)\n    }\n  }\n}\n"]}