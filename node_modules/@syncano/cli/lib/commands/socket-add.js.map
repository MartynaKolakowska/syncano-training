{"version":3,"sources":["../../src/commands/socket-add.js"],"names":["debug","SocketAdd","constructor","context","session","Socket","registry","Registry","run","socketName","cmd","socketFromRegistry","searchSocketByName","name","vesrion","socket","get","addDependency","add","status","format","grey","cyan","version","dim","deploy","SocketDeployCmd","err","response","data","red","message"],"mappings":";;;;;;AAAA;;;;AAEA;;;;AACA;;AACA;;AACA;;;;;;;;AAEA,MAAM,EAAEA,KAAF,KAAY,qBAAO,oBAAP,CAAlB;;AAEe,MAAMC,SAAN,CAAgB;AAC7BC,cAAaC,OAAb,EAAsB;AACpB,SAAKA,OAAL,GAAeA,OAAf;AACA,SAAKC,OAAL,GAAeD,QAAQC,OAAvB;AACA,SAAKC,MAAL,GAAcF,QAAQE,MAAtB;AACA,SAAKC,QAAL,GAAgB,IAAIH,QAAQI,QAAZ,EAAhB;AACD;;AAEKC,KAAN,CAAW,CAACC,UAAD,EAAaC,GAAb,CAAX,EAA8B;AAAA;;AAAA;AAC5B,UAAI,CAACD,UAAL,EAAiB,OAAO,uBAAM,sCAAN,CAAP;;AAEjB,UAAI;AACF,cAAME,qBAAqB,MAAM,MAAKL,QAAL,CAAcM,kBAAd,CAAiCH,UAAjC,CAAjC;AACAT,cAAO,iBAAgBW,mBAAmBE,IAAK,IAAGF,mBAAmBG,OAAQ,EAA7E;AACA,cAAKH,kBAAL,GAA0BA,kBAA1B;;AAEA,YAAID,IAAIK,MAAR,EAAgB;AACd;AACA,gBAAKA,MAAL,GAAc,MAAM,MAAKV,MAAL,CAAYW,GAAZ,CAAgBN,IAAIK,MAApB,CAApB;AACA,gBAAM,MAAKA,MAAL,CAAYE,aAAZ,CAA0BN,kBAA1B,CAAN;AACD,SAJD,MAIO;AACL;AACA,gBAAM,MAAKN,MAAL,CAAYa,GAAZ,CAAgBP,kBAAhB,CAAN;AACD;;AAED,cAAMQ,SAASC,gBAAOC,IAAP,CAAY,eAAZ,CAAf;AACA,cAAMR,OAAOO,gBAAOE,IAAP,CAAY,MAAKX,kBAAL,CAAwBE,IAApC,CAAb;AACA,cAAMU,UAAUH,gBAAOI,GAAP,CAAY,IAAG,MAAKb,kBAAL,CAAwBY,OAAQ,GAA/C,CAAhB;AACA,8BAAK,CAAL,EAAS,GAAEJ,MAAO,IAAG,6BAAc,IAAGN,IAAK,IAAGU,OAAQ,EAAtD;;AAEA,cAAME,SAAS,MAAM,IAAIC,sBAAJ,CAAoB,MAAKvB,OAAzB,CAArB;;AAEA,YAAIO,IAAIK,MAAR,EAAgB;AACd,iBAAOU,OAAOjB,GAAP,CAAW,CAAC,MAAKO,MAAL,CAAYF,IAAb,EAAmB,EAAnB,CAAX,CAAP;AACD;AACD,eAAOY,OAAOjB,GAAP,CAAW,CAAC,MAAKG,kBAAL,CAAwBE,IAAzB,EAA+B,EAA/B,CAAX,CAAP;AACD,OAzBD,CAyBE,OAAOc,GAAP,EAAY;AACZ,YAAIA,IAAIC,QAAR,EAAkB;AAChB,cAAID,IAAIC,QAAJ,CAAaT,MAAb,KAAwB,GAA5B,EAAiC;AAC/B;AACA,kCAAK,CAAL,EAAQ,oBAAR;AACA,kCAAK,CAAL,EAAS,8BAA6BC,gBAAOE,IAAP,CAAY,kCAAZ,CAAgD,EAAtF;AACA;AACA;AACD;AACD,cAAIK,IAAIC,QAAJ,CAAaC,IAAb,IAAqBF,IAAIC,QAAJ,CAAaC,IAAb,CAAkBhB,IAA3C,EAAiD;AAC/C;AACA;AACA,mCAAM,CAAN,EAASO,gBAAOU,GAAP,CAAY,WAAUrB,UAAW,+BAAjC,CAAT;AACA,kCAAK,CAAL,EAAS,mBAAkBW,gBAAOE,IAAP,CAAa,uBAAsBb,UAAW,EAA9C,CAAiD,EAA5E;AACA;AACD;AACF,SAfD,MAeO;AACL;AACA,cAAIkB,IAAII,OAAR,EAAiB;AACf,kCAAM,GAAEX,gBAAOU,GAAP,CAAWH,IAAII,OAAf,CAAwB,IAAhC;AACD,WAFD,MAEO;AACL,kCAAM,GAAEX,gBAAOU,GAAP,CAAWH,GAAX,CAAgB,IAAxB;AACD;AACD;AACD;AACF;AArD2B;AAsD7B;AA9D4B;kBAAV1B,S","file":"socket-add.js","sourcesContent":["import format from 'chalk'\n\nimport logger from '../utils/debug'\nimport { echo, error } from '../utils/print-tools'\nimport { currentTime } from '../utils/date-utils'\nimport SocketDeployCmd from './socket-deploy'\n\nconst { debug } = logger('cmd-socket-install')\n\nexport default class SocketAdd {\n  constructor (context) {\n    this.context = context\n    this.session = context.session\n    this.Socket = context.Socket\n    this.registry = new context.Registry()\n  }\n\n  async run ([socketName, cmd]) {\n    if (!socketName) return error('Socket name is a required parameter!')\n\n    try {\n      const socketFromRegistry = await this.registry.searchSocketByName(socketName)\n      debug(`socket found: ${socketFromRegistry.name} ${socketFromRegistry.vesrion}`)\n      this.socketFromRegistry = socketFromRegistry\n\n      if (cmd.socket) {\n        // Socket dependency\n        this.socket = await this.Socket.get(cmd.socket)\n        await this.socket.addDependency(socketFromRegistry)\n      } else {\n        // Project dependency\n        await this.Socket.add(socketFromRegistry)\n      }\n\n      const status = format.grey('socket added:')\n      const name = format.cyan(this.socketFromRegistry.name)\n      const version = format.dim(`(${this.socketFromRegistry.version})`)\n      echo(7)(`${status} ${currentTime()} ${name} ${version}`)\n\n      const deploy = await new SocketDeployCmd(this.context)\n\n      if (cmd.socket) {\n        return deploy.run([this.socket.name, {}])\n      }\n      return deploy.run([this.socketFromRegistry.name, {}])\n    } catch (err) {\n      if (err.response) {\n        if (err.response.status === 404) {\n          echo()\n          echo(4)('No socket found ðŸ˜•')\n          echo(4)(`To search for socket type: ${format.cyan('syncano-cli search <socket name>')}`)\n          echo()\n          return\n        }\n        if (err.response.data && err.response.data.name) {\n          // Something wrong with the name\n          echo()\n          error(4)(format.red(`Socket \"${socketName}\" has already been installed!`))\n          echo(4)(`To upgrade type ${format.cyan(`syncano-cli upgrade ${socketName}`)}`)\n          echo()\n        }\n      } else {\n        echo()\n        if (err.message) {\n          echo(`${format.red(err.message)}\\n`)\n        } else {\n          echo(`${format.red(err)}\\n`)\n        }\n        echo()\n      }\n    }\n  }\n}\n"]}